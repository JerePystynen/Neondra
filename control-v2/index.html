<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neondra Control Panel</title>
    <link rel="shortcut icon" href="https://neondra.com/neondra/assets/images/logo/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="./style.css">
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three/build/three.module.js",
            "three/addons/": "https://unpkg.com/three/examples/jsm/"
        }
    }
    </script>
    <!-- Color Picker -->
    <script src='https://cdn.jsdelivr.net/npm/@jaames/iro/dist/iro.min.js'></script>
</head>
<body class="flex-wrap">
    <section>
        <div>
            <div>
                <span id="status-suit-mode">Mode: -</span>
                <span id="status-audiofile-playing">Playing: -</span>
                <span id="status-audiofile-volume">Volume: - %</span>
                <span id="status-battery-percentage">Battery: - %</span>
                <span id="status-battery-voltage">Volts: - V</span>
                <span id="status-battery-amperage">Amps: - A</span>
                <span id="status-battery-remaining">Rem: - h</span>
            </div>
            <div>
                <span id="status-torso-connected">Torso: Disconnected</span>
                <span id="status-wings-connected">| Wings: Disconnected</span>
                <span id="status-claws-connected">| Claws: Disconnected</span>
                <span id="status-legs-connected">| Legs: Disconnected</span>
            </div>
            <div>
                <span id="status-spitfire-connected">Spitfire: Disconnected</span>
            </div>
        </div>
    </section>
    <section class="split-left flex-wrap">
        <div>
            <div class="flex-wrap">
                <h2>Suit Mode:</h2>
                <a class="button icon flex" selected="false" onclick="sendData('set-helmet=default');"><img src="./img/default.png" alt="Default" title="Default"></a>
                <a class="button icon flex" selected="false" onclick="sendData('set-helmet=love');"><img src="./img/love.png" alt="Love" title="Love"></a>
                <a class="button icon flex" selected="false" onclick="sendData('set-helmet=fury');"><img src="./img/fury.png" alt="Fury" title="Fury"></a>
                <a class="button" selected="true" onclick="sendData('set-helmet=wink');">Wink</a>
                <a class="button" selected="false" onclick="sendData('set-helmet=sad');">Sad</a>
            </div>
            <div class="flex-wrap">
                <h2>Helmet Display:</h2>
                <a class="button" selected="false" onclick="sendData('set-helmet=vumeter');">Music Visualizer</a>
                <a class="button" selected="true" onclick="sendData('set-helmet=datetime');">Datetime</a>
                <a class="button" selected="false" onclick="sendData('set-helmet=subcount');">Subcount</a>
                <a class="button" selected="false" onclick="sendData('set-animation-playstate=true');">Play Animation</a>
                <a class="button" selected="false" onclick="sendData('set-animation-playstate=false');">Stop Animation</a>
            </div>
            <div>
                <h2>Overwrite Matrix Color:</h2></br>
                <a class="button" selected="false" onclick="sendData('set-helmet=0000FF');">Blue</a>
                <a class="button" selected="false" onclick="sendData('set-helmet=00FF00');">Green</a>
                <a class="button" selected="false" onclick="sendData('set-helmet=FF0000');">Red</a>
                <a class="button" selected="false" onclick="sendData('set-helmet=FFA500');">Orange</a>
                <a class="button" selected="false" onclick="sendData('set-helmet=FFFF00');">Yellow</a>
                <a class="button" selected="false" onclick="sendData('set-helmet=FFC0CB');">Pink</a>
            </div>
        </div>
    </section>
    <section class="split-right">
        <div class="wrap">
            <div class="half">
                <div class="colorPicker"></div>
            </div>
            <div class="half-readout">
                <span class="title">Selected Color:</span>
                <div id="values"></div>
                <input id="hexInput" style="outline: none;border: 0;"></input>
            </div>
        </div>
        <div class="flex">
            <h2>Play Audio:</h2>
            <div class="file-list" files-found="true">
                <span class="status-no-files">No Files Found! Check the SD!</span>
                <a class="button item" selected="false" onclick="playAudio('1');">Sample Audio Track 1</a>
                <a class="button item" selected="false" onclick="playAudio('2');">Sample Audio Track 2</a>
                <a class="button item" selected="false" onclick="playAudio('3');">Sample Audio Track 3</a>
                <a class="button item" selected="false" onclick="playAudio('2');">Sample Audio Track 2</a>
                <a class="button item" selected="false" onclick="playAudio('3');">Sample Audio Track 3</a>
                <a class="button item" selected="false" onclick="playAudio('2');">Sample Audio Track 2</a>
                <a class="button item" selected="false" onclick="playAudio('3');">Sample Audio Track 3</a>
                <a class="button item" selected="false" onclick="playAudio('2');">Sample Audio Track 2</a>
                <a class="button item" selected="false" onclick="playAudio('3');">Sample Audio Track 3</a>
            </div>
            <a class="button" onclick="playAudio('0');">Stop Playing</a>
        </div>
        <div>
            <h2>Controls</h2>
            <h3>The Helmet:</h3>
            <div>
                <img src="./img/brightness.png" alt="Brightness">
                <span>Mouth:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-helmet-brightness">
                <span>50%</span>
            </div>
            <div>
                <img src="./img/brightness.png" alt="Brightness">
                <span>Headband:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-helmet-brightness">
                <span>50%</span>
            </div>
            <div>
                <img src="./img/brightness.png" alt="Brightness">
                <span>Left Eye:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-helmet-brightness">
                <span>50%</span>
            </div>
            <div>
                <img src="./img/brightness.png" alt="Brightness">
                <span>Right Eye:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-helmet-brightness">
                <span>50%</span>
            </div>
            <div>
                <img src="./img/brightness.png" alt="Brightness">
                <span>Forehead:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-helmet-brightness">
                <span>50%</span>
            </div>
            <div>
                <img src="./img/brightness.png" alt="Brightness">
                <span>Rings:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-helmet-brightness">
                <span>50%</span>
            </div>
            <div>
                <img src="./img/fan.png" alt="Fan">
                <span>Fan Speed:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-helmet-fan">
                <span>50%</span>
            </div>
            <h3>The Torso:</h3>
            <div>
                <img src="./img/brightness.png" alt="Brightness">
                <span>Center:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-helmet-brightness">
                <span>50%</span>
            </div>
            <h3>The Wings:</h3>
            <div>
                <img src="./img/fan.png" alt="Fan">
                <span>Motor:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-wings">
                <span>50%</span>
            </div>
            <div>
                <img src="./img/brightness.png" alt="Brightness">
                <span>Brightness:</span>
                <input type="range" min="0" max="100" value="50" class="slider" id="set-wing-brightness">
                <span>50%</span>
            </div>
        </div>
    </section>

    <script>
        var colorPicker = new iro.ColorPicker(".colorPicker", {
            width: 180,
            color: "rgb(255, 0, 0)",
            borderWidth: 1,
            borderColor: "#fff"
        });
        var values = document.getElementById("values");
        var hexInput = document.getElementById("hexInput");
        colorPicker.on(["color:init", "color:change"], function (color) {
            // values.innerHTML = [
            //     "hex: " + color.hexString,
            //     "rgb: " + color.rgbString,
            //     "hsl: " + color.hslString].
            //     join("<br>");
            hexInput.value = color.hexString;
        });
        hexInput.addEventListener('change', function () {
            colorPicker.color.hexString = this.value;
        });
    </script>
    <script>
        function sendData(data) {
            fetch('/ajax', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'plain=' + encodeURIComponent(data),
            }).then(response => response.text()).then(result => {
                console.log('Server response:', result);
            }).catch(error => {
                console.error('Error:', error);
            });
        }
        function playAudio(audioFile) {
            sendData(`play-audio=${audioFile}`);
        }
        Array.from(document.getElementsByClassName('slider')).forEach(slider => {
            slider.value = slider.getAttribute('value');
            slider.addEventListener('input', function (e) {
                slider.parentNode.children[2].textContent = `${slider.value}%`;
            });
            slider.addEventListener('change', function (e) {
                sendData(`${slider.getAttribute('id')}=${slider.value / 100}`);
            });
        });
    </script>
    <script type="module" src="./index.js"></script>
</body>
<footer>
    <span>Welcome to Neondra's control panel v2, powered by an ESP8266!</span>
</footer>
</html>